{"version":3,"file":"component---src-pages-profile-page-delete-account-button-js.js","mappings":"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","sources":["webpack://blabzio/./src/Accounts/useAuth.js","webpack://blabzio/./src/pages/ProfilePage/DeleteAccountButton.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport 'firebase/auth';\n\nimport 'firebase/database';\nimport firebase from 'firebase/compat/app';\nimport 'firebase/compat/database';\nimport 'firebase/compat/auth';\nimport 'firebase/compat/firestore';\n\nconst firebaseConfig2 = {\n\n  apiKey: \"AIzaSyAM5p7O6YuAvCxfDCbR48Duz019qkoVp0Y\",\n\n  authDomain: \"itsmynodezena.firebaseapp.com\",\n\n  databaseURL: \"https://itsmynodezena-default-rtdb.firebaseio.com\",\n\n  projectId: \"itsmynodezena\",\n\n  storageBucket: \"itsmynodezena.appspot.com\",\n\n  messagingSenderId: \"299392955521\",\n\n  appId: \"1:299392955521:web:ef5671ad2702d441304980\"\n\n};\n\nexport function useAuth() {\n\n\n  firebase.initializeApp(firebaseConfig2, 'app05');\n  const app05 = firebase.app('app05');\nconst apps = app05;\n\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState();\n\n  useEffect(() => {\n    const unsubscribe = app05.auth().onAuthStateChanged((firebaseUser) => {\n      if (firebaseUser) {\n        setUser(firebaseUser);\n        setLoading(true);\n      } else {\n        setUser(null);\n        setLoading(false);\n      }\n    });\n    return () => unsubscribe();\n  }, []);\n\n\n  function signInWithEmailAndPassword(email, password) {\n    return app05.auth().signInWithEmailAndPassword(email, password);\n  }\n\n  function signOut() {\n   setUser(\"\")\n    return app05.auth().signOut();\n    \n  }\n\n  return { apps, user,setUser, app05, loading, signInWithEmailAndPassword, signOut };\n}","import React, { useState } from 'react';\nimport firebase from 'firebase/compat/app';\n\nimport { useAuth } from '../../Accounts/useAuth';\nimport { Button } from 'primereact/button';\nimport { Toast } from 'primereact/toast';\nimport { navigate } from 'gatsby';\n//import { ButtonToolbar } from 'react-bootstrap';\n\nconst firebaseConfig2 = {\n  apiKey: \"AIzaSyAM5p7O6YuAvCxfDCbR48Duz019qkoVp0Y\",\n\n  authDomain: \"itsmynodezena.firebaseapp.com\",\n\n  databaseURL: \"https://itsmynodezena-default-rtdb.firebaseio.com\",\n\n  projectId: \"itsmynodezena\",\n\n  storageBucket: \"itsmynodezena.appspot.com\",\n\n  messagingSenderId: \"299392955521\",\n\n  appId: \"1:299392955521:web:ef5671ad2702d441304980\"\n\n};\n\n\nconst firebaseConfig922 = {\n\n  apiKey: \"AIzaSyA4-6Spjqf7Z_ks7fak2jnGKqtJG4uRqMk\",\n\n  authDomain: \"zenahubglob.firebaseapp.com\",\n\n  databaseURL: \"https://zenahubglob-default-rtdb.firebaseio.com\",\n\n  projectId: \"zenahubglob\",\n\n  storageBucket: \"zenahubglob.appspot.com\",\n\n  messagingSenderId: \"414119474155\",\n\n  appId: \"1:414119474155:web:d93f733443172ecd739fae\",\n\n  measurementId: \"G-B65PR7NNXS\"\n\n};\n\nfunction DeleteAccountButton({toastRef}) {\n const one = firebase.initializeApp(firebaseConfig2, 'app0155');\nconst two = firebase.initializeApp(firebaseConfig922, 'app01922');\n\n  \n\n  const { user,setUser,signOut } = useAuth();\n\n  const app4 = firebase.app('app0155');\nconst app44 = firebase.app('app01922');\n  const [loading, setLoading] = useState(false);\n  const [toast, setToast] = useState(null);\n\n\n  const handleDeleteAccount = async () => {\n    if (user) {\n      setLoading(true);\n\n      try {\n        const userId = user.uid; // Get the user ID before deleting the account\n        await user.delete();\n        await signOut();\n        navigate('/');\n\n        toastRef.current.show({\n          severity: 'success',\n          summary: 'Account deleted',\n          detail: 'Your account has been successfully deleted.'\n        });\n\n        await handleUserDeletion(userId); // Pass the user ID to the function\n       await handleUserDeleteData(userId)\n      } catch (error) {\n        if (error.code === 'auth/requires-recent-login') {\n          await signOut();\n\n          toastRef.current.show({\n            severity: 'warn',\n            summary: 'Session expired',\n            detail: 'You need to sign in again to delete your account.'\n          });\n        } else {\n          toastRef.current.show({\n            severity: 'error',\n            summary: 'Error deleting account',\n            detail: error.message\n          });\n        }\n      } finally {\n        setLoading(false);\n      }\n    }\n  };\n\n  const handleUserDeletion = async (userId) => {\n    try {\n      // Reference the comments path in the Realtime Database\n      const commentsRef = app44.database().ref('comments/cards');\n\n      // Query the comments where userId matches the user ID\n      const snapshot = await commentsRef\n        .orderByChild('userId')\n        .equalTo(userId)\n        .once('value');\n\n      // Create an object to store the updates\n      const updates = {};\n\n      // Iterate through each comment\n      snapshot.forEach((childSnapshot) => {\n        updates[childSnapshot.key] = null;\n      });\n\n      // Update the comments with null values to delete them\n      await commentsRef.update(updates);\n    } catch (error) {\n      console.error('Error deleting user data:', error);\n    }\n  };\n\n  const handleUserDeleteData = async (userId) => {\n    try {\n      // Reference the profile path in the Realtime Database\n      const profileRef = app4.database().ref('profile');\n  \n      // Query the profile data once\n      const snapshot = await profileRef.once('value');\n  \n      // Create an object to store the updates\n      const updates = {};\n  \n      // Iterate through each profile entry\n      snapshot.forEach((childSnapshot) => {\n        // Check if the key (ID) matches the user ID\n        if (childSnapshot.key === userId) {\n          updates[childSnapshot.key] = null;\n        }\n      });\n  \n      // Update the profile data with null values to delete the entry\n      await profileRef.update(updates);\n    } catch (error) {\n      console.error('Error deleting user data:', error);\n    }\n  };\n  \n  return (\n    <>\n      <Button style={{backgroundColor: 'red', outline:\"red\"}} severity=\"danger\"  label=\"I understand, delete my account\" onClick={handleDeleteAccount} disabled={loading} />\n \n    </>\n  );\n}\n\nexport default DeleteAccountButton;\n"],"names":["useState","useEffect","firebase","firebaseConfig2","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","useAuth","initializeApp","app05","app","apps","user","setUser","loading","setLoading","unsubscribe","auth","onAuthStateChanged","firebaseUser","signInWithEmailAndPassword","email","password","signOut","React","Button","Toast","navigate","firebaseConfig922","measurementId","DeleteAccountButton","toastRef","one","two","app4","app44","toast","setToast","handleDeleteAccount","userId","uid","delete","current","show","severity","summary","detail","handleUserDeletion","handleUserDeleteData","error","code","message","commentsRef","database","ref","snapshot","orderByChild","equalTo","once","updates","forEach","childSnapshot","key","update","console","profileRef","createElement","Fragment","style","backgroundColor","outline","label","onClick","disabled"],"sourceRoot":""}