{"version":3,"file":"component---src-pages-profile-page-security-js-183299b17f25c66187ba.js","mappings":"qKASA,MAAMA,EAAkB,CACtBC,OAAQ,0CAERC,WAAY,gCAEZC,YAAa,oDAEbC,UAAW,gBAEXC,cAAe,4BAEfC,kBAAmB,eAEnBC,MAAO,6CAKHC,EAAoB,CAExBP,OAAQ,0CAERC,WAAY,8BAEZC,YAAa,kDAEbC,UAAW,cAEXC,cAAe,0BAEfC,kBAAmB,eAEnBC,MAAO,4CAEPE,cAAe,gBAsHjB,UAlHA,SAA4BC,GAAc,IAAb,SAACC,GAASD,EAC1BE,EAAAA,EAASC,cAAcb,EAAiB,WACzCY,EAAAA,EAASC,cAAcL,EAAmB,YADrD,MAKO,KAAEM,EAAI,QAACC,EAAO,QAACC,IAAYC,EAAAA,EAAAA,KAE3BC,EAAON,EAAAA,EAASO,IAAI,WACtBC,EAAQR,EAAAA,EAASO,IAAI,aACnB,EAACE,EAAQ,EAACC,IAAcC,EAAAA,EAAAA,WAAS,IACjC,EAACC,EAAM,EAACC,IAAYF,EAAAA,EAAAA,UAAS,MA2C7BG,EAAqBC,UACzB,IAEE,MAAMC,EAAcR,EAAMS,WAAWC,IAAI,kBAGnCC,QAAiBH,EACpBI,aAAa,UACbC,QAAQC,GACRC,KAAK,SAGFC,EAAU,CAAC,EAGjBL,EAASM,SAASC,IAChBF,EAAQE,EAAcC,KAAO,IAAI,UAI7BX,EAAYY,OAAOJ,EAC3B,CAAE,MAAOK,GACPC,QAAQD,MAAM,4BAA6BA,EAC7C,GAGIE,EAAuBhB,UAC3B,IAEE,MAAMiB,EAAa1B,EAAKW,WAAWC,IAAI,WAGjCC,QAAiBa,EAAWT,KAAK,SAGjCC,EAAU,CAAC,EAGjBL,EAASM,SAASC,IAEZA,EAAcC,MAAQL,IACxBE,EAAQE,EAAcC,KAAO,KAC/B,UAIIK,EAAWJ,OAAOJ,EAC1B,CAAE,MAAOK,GACPC,QAAQD,MAAM,4BAA6BA,EAC7C,GAGF,OACEI,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACC,EAAAA,EAAM,CAACC,MAAO,CAACC,gBAAiB,MAAOC,QAAQ,OAAQC,SAAS,SAAUC,MAAM,kCAAkCC,QA9F3FzB,UAC1B,GAAIb,EAAM,CACRQ,GAAW,GAEX,IACE,MAAMY,EAASpB,EAAKuC,UACdvC,EAAKwC,eACLtC,KACNuC,EAAAA,EAAAA,UAAS,KAET5C,EAAS6C,QAAQC,KAAK,CACpBP,SAAU,UACVQ,QAAS,kBACTC,OAAQ,sDAGJjC,EAAmBQ,SACpBS,EAAqBT,EAC5B,CAAE,MAAOO,GACY,+BAAfA,EAAMmB,YACF5C,IAENL,EAAS6C,QAAQC,KAAK,CACpBP,SAAU,OACVQ,QAAS,kBACTC,OAAQ,uDAGVhD,EAAS6C,QAAQC,KAAK,CACpBP,SAAU,QACVQ,QAAS,yBACTC,OAAQlB,EAAMoB,SAGpB,CAAC,QACCvC,GAAW,EACb,CACF,GAyDmJwC,SAAUzC,IAIjK,C,4KCvHe,SAAS0C,IAExB,OACElB,EAAAA,cAAA,WAIF,CAEO,MAAMmB,EAAOA,IAAMnB,EAAAA,cAAA,aAAO,W","sources":["webpack://blabzio/./src/pages/ProfilePage/DeleteAccountButton.js","webpack://blabzio/./src/pages/ProfilePage/Security.js"],"sourcesContent":["import React, { useState } from 'react';\nimport firebase from 'firebase/compat/app';\n\nimport { useAuth } from '../../Accounts/useAuth';\nimport { Button } from 'primereact/button';\nimport { Toast } from 'primereact/toast';\nimport { navigate } from 'gatsby';\n//import { ButtonToolbar } from 'react-bootstrap';\n\nconst firebaseConfig2 = {\n  apiKey: \"AIzaSyAM5p7O6YuAvCxfDCbR48Duz019qkoVp0Y\",\n\n  authDomain: \"itsmynodezena.firebaseapp.com\",\n\n  databaseURL: \"https://itsmynodezena-default-rtdb.firebaseio.com\",\n\n  projectId: \"itsmynodezena\",\n\n  storageBucket: \"itsmynodezena.appspot.com\",\n\n  messagingSenderId: \"299392955521\",\n\n  appId: \"1:299392955521:web:ef5671ad2702d441304980\"\n\n};\n\n\nconst firebaseConfig922 = {\n\n  apiKey: \"AIzaSyA4-6Spjqf7Z_ks7fak2jnGKqtJG4uRqMk\",\n\n  authDomain: \"zenahubglob.firebaseapp.com\",\n\n  databaseURL: \"https://zenahubglob-default-rtdb.firebaseio.com\",\n\n  projectId: \"zenahubglob\",\n\n  storageBucket: \"zenahubglob.appspot.com\",\n\n  messagingSenderId: \"414119474155\",\n\n  appId: \"1:414119474155:web:d93f733443172ecd739fae\",\n\n  measurementId: \"G-B65PR7NNXS\"\n\n};\n\nfunction DeleteAccountButton({toastRef}) {\n const one = firebase.initializeApp(firebaseConfig2, 'app0155');\nconst two = firebase.initializeApp(firebaseConfig922, 'app01922');\n\n\n\n  const { user,setUser,signOut } = useAuth();\n\n  const app4 = firebase.app('app0155');\nconst app44 = firebase.app('app01922');\n  const [loading, setLoading] = useState(false);\n  const [toast, setToast] = useState(null);\n\n\n  const handleDeleteAccount = async () => {\n    if (user) {\n      setLoading(true);\n\n      try {\n        const userId = user.uid; // Get the user ID before deleting the account\n        await user.delete();\n        await signOut();\n        navigate('/');\n\n        toastRef.current.show({\n          severity: 'success',\n          summary: 'Account deleted',\n          detail: 'Your account has been successfully deleted.'\n        });\n\n        await handleUserDeletion(userId); // Pass the user ID to the function\n       await handleUserDeleteData(userId)\n      } catch (error) {\n        if (error.code === 'auth/requires-recent-login') {\n          await signOut();\n\n          toastRef.current.show({\n            severity: 'warn',\n            summary: 'Session expired',\n            detail: 'You need to sign in again to delete your account.'\n          });\n        } else {\n          toastRef.current.show({\n            severity: 'error',\n            summary: 'Error deleting account',\n            detail: error.message\n          });\n        }\n      } finally {\n        setLoading(false);\n      }\n    }\n  };\n\n  const handleUserDeletion = async (userId) => {\n    try {\n      // Reference the comments path in the Realtime Database\n      const commentsRef = app44.database().ref('comments/cards');\n\n      // Query the comments where userId matches the user ID\n      const snapshot = await commentsRef\n        .orderByChild('userId')\n        .equalTo(userId)\n        .once('value');\n\n      // Create an object to store the updates\n      const updates = {};\n\n      // Iterate through each comment\n      snapshot.forEach((childSnapshot) => {\n        updates[childSnapshot.key] = null;\n      });\n\n      // Update the comments with null values to delete them\n      await commentsRef.update(updates);\n    } catch (error) {\n      console.error('Error deleting user data:', error);\n    }\n  };\n\n  const handleUserDeleteData = async (userId) => {\n    try {\n      // Reference the profile path in the Realtime Database\n      const profileRef = app4.database().ref('profile');\n\n      // Query the profile data once\n      const snapshot = await profileRef.once('value');\n\n      // Create an object to store the updates\n      const updates = {};\n\n      // Iterate through each profile entry\n      snapshot.forEach((childSnapshot) => {\n        // Check if the key (ID) matches the user ID\n        if (childSnapshot.key === userId) {\n          updates[childSnapshot.key] = null;\n        }\n      });\n\n      // Update the profile data with null values to delete the entry\n      await profileRef.update(updates);\n    } catch (error) {\n      console.error('Error deleting user data:', error);\n    }\n  };\n\n  return (\n    <>\n      <Button style={{backgroundColor: 'red', outline:\"red\"}} severity=\"danger\"  label=\"I understand, delete my account\" onClick={handleDeleteAccount} disabled={loading} />\n\n    </>\n  );\n}\n\nexport default DeleteAccountButton;\n","import { Link } from 'gatsby';\nimport React, { useEffect, useState, useRef } from 'react';\nimport * as pro from '../../styles/profile.module.css';\nimport firebase from 'firebase/compat/app';\nimport { useAuth } from '../../Accounts/useAuth';\n\nimport 'firebase/compat/auth';\nimport im from '../../images/proxy.jpeg';\n//import { initializeApp } from \"firebase/app\";\n//import Language from '../Language';\n//import { useTranslation , Trans} from 'react-i18next' ./Profile;\nimport Navbar from './Navbared';\nimport { Password } from 'primereact/password';\nimport { Toast } from 'primereact/toast';\nimport {confirmDialog, ConfirmDialog} from 'primereact/confirmdialog';\nimport {RadioButton} from \"primereact/radiobutton\";\nimport {InputNumber} from \"primereact/inputnumber\";\nimport DeleteAccountButton from './DeleteAccountButton';\nimport { event } from 'jquery';\nimport {ProgressSpinner} from 'primereact/progressspinner';\n\nconst firebaseConfig2 = {\n  apiKey: \"AIzaSyAM5p7O6YuAvCxfDCbR48Duz019qkoVp0Y\",\n\n  authDomain: \"itsmynodezena.firebaseapp.com\",\n\n  databaseURL: \"https://itsmynodezena-default-rtdb.firebaseio.com\",\n\n  projectId: \"itsmynodezena\",\n\n  storageBucket: \"itsmynodezena.appspot.com\",\n\n  messagingSenderId: \"299392955521\",\n\n  appId: \"1:299392955521:web:ef5671ad2702d441304980\"\n  \n  };\n  \n  \n\nexport default function Security() {\n\nreturn(\n  <div>\n    \n  </div>\n  )\n}\n\nexport const Head = () => <title>Security</title>\n"],"names":["firebaseConfig2","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","firebaseConfig922","measurementId","_ref","toastRef","firebase","initializeApp","user","setUser","signOut","useAuth","app4","app","app44","loading","setLoading","useState","toast","setToast","handleUserDeletion","async","commentsRef","database","ref","snapshot","orderByChild","equalTo","userId","once","updates","forEach","childSnapshot","key","update","error","console","handleUserDeleteData","profileRef","React","Button","style","backgroundColor","outline","severity","label","onClick","uid","delete","navigate","current","show","summary","detail","code","message","disabled","Security","Head"],"sourceRoot":""}