{"version":3,"file":"component---src-pages-profile-page-delete-account-button-js-1dee69d90980353f9f95.js","mappings":"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","sources":["webpack://blabzio/./src/Accounts/useAuth.js","webpack://blabzio/./src/pages/ProfilePage/DeleteAccountButton.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport 'firebase/auth';\n\nimport 'firebase/database';\nimport firebase from 'firebase/compat/app';\nimport 'firebase/compat/database';\nimport 'firebase/compat/auth';\nimport 'firebase/compat/firestore';\n\nconst firebaseConfig2 = {\n\n  apiKey: \"AIzaSyAM5p7O6YuAvCxfDCbR48Duz019qkoVp0Y\",\n\n  authDomain: \"itsmynodezena.firebaseapp.com\",\n\n  databaseURL: \"https://itsmynodezena-default-rtdb.firebaseio.com\",\n\n  projectId: \"itsmynodezena\",\n\n  storageBucket: \"itsmynodezena.appspot.com\",\n\n  messagingSenderId: \"299392955521\",\n\n  appId: \"1:299392955521:web:ef5671ad2702d441304980\"\n\n};\n\nexport function useAuth() {\n\n\n  firebase.initializeApp(firebaseConfig2, 'app05');\n  const app05 = firebase.app('app05');\nconst apps = app05;\n\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState();\n\n  useEffect(() => {\n    const unsubscribe = app05.auth().onAuthStateChanged((firebaseUser) => {\n      if (firebaseUser) {\n        setUser(firebaseUser);\n        setLoading(true);\n      } else {\n        setUser(null);\n        setLoading(false);\n      }\n    });\n    return () => unsubscribe();\n  }, []);\n\n\n  function signInWithEmailAndPassword(email, password) {\n    return app05.auth().signInWithEmailAndPassword(email, password);\n  }\n\n  function signOut() {\n   setUser(\"\")\n    return app05.auth().signOut();\n    \n  }\n\n  return { apps, user,setUser, app05, loading, signInWithEmailAndPassword, signOut };\n}","import React, { useState } from 'react';\nimport firebase from 'firebase/compat/app';\n\nimport { useAuth } from '../../Accounts/useAuth';\nimport { Button } from 'primereact/button';\nimport { Toast } from 'primereact/toast';\nimport { navigate } from 'gatsby';\n//import { ButtonToolbar } from 'react-bootstrap';\n\nconst firebaseConfig2 = {\n  apiKey: \"AIzaSyAM5p7O6YuAvCxfDCbR48Duz019qkoVp0Y\",\n\n  authDomain: \"itsmynodezena.firebaseapp.com\",\n\n  databaseURL: \"https://itsmynodezena-default-rtdb.firebaseio.com\",\n\n  projectId: \"itsmynodezena\",\n\n  storageBucket: \"itsmynodezena.appspot.com\",\n\n  messagingSenderId: \"299392955521\",\n\n  appId: \"1:299392955521:web:ef5671ad2702d441304980\"\n\n};\n\n\nconst firebaseConfig922 = {\n\n  apiKey: \"AIzaSyA4-6Spjqf7Z_ks7fak2jnGKqtJG4uRqMk\",\n\n  authDomain: \"zenahubglob.firebaseapp.com\",\n\n  databaseURL: \"https://zenahubglob-default-rtdb.firebaseio.com\",\n\n  projectId: \"zenahubglob\",\n\n  storageBucket: \"zenahubglob.appspot.com\",\n\n  messagingSenderId: \"414119474155\",\n\n  appId: \"1:414119474155:web:d93f733443172ecd739fae\",\n\n  measurementId: \"G-B65PR7NNXS\"\n\n};\n\nfunction DeleteAccountButton({toastRef}) {\n const one = firebase.initializeApp(firebaseConfig2, 'app0155');\nconst two = firebase.initializeApp(firebaseConfig922, 'app01922');\n\n\n\n  const { user,setUser,signOut } = useAuth();\n\n  const app4 = firebase.app('app0155');\nconst app44 = firebase.app('app01922');\n  const [loading, setLoading] = useState(false);\n  const [toast, setToast] = useState(null);\n\n\n  const handleDeleteAccount = async () => {\n    if (user) {\n      setLoading(true);\n\n      try {\n        const userId = user.uid; // Get the user ID before deleting the account\n        await user.delete();\n        await signOut();\n        navigate('/');\n\n        toastRef.current.show({\n          severity: 'success',\n          summary: 'Account deleted',\n          detail: 'Your account has been successfully deleted.'\n        });\n\n        await handleUserDeletion(userId); // Pass the user ID to the function\n       await handleUserDeleteData(userId)\n      } catch (error) {\n        if (error.code === 'auth/requires-recent-login') {\n          await signOut();\n\n          toastRef.current.show({\n            severity: 'warn',\n            summary: 'Session expired',\n            detail: 'You need to sign in again to delete your account.'\n          });\n        } else {\n          toastRef.current.show({\n            severity: 'error',\n            summary: 'Error deleting account',\n            detail: error.message\n          });\n        }\n      } finally {\n        setLoading(false);\n      }\n    }\n  };\n\n  const handleUserDeletion = async (userId) => {\n    try {\n      // Reference the comments path in the Realtime Database\n      const commentsRef = app44.database().ref('comments/cards');\n\n      // Query the comments where userId matches the user ID\n      const snapshot = await commentsRef\n        .orderByChild('userId')\n        .equalTo(userId)\n        .once('value');\n\n      // Create an object to store the updates\n      const updates = {};\n\n      // Iterate through each comment\n      snapshot.forEach((childSnapshot) => {\n        updates[childSnapshot.key] = null;\n      });\n\n      // Update the comments with null values to delete them\n      await commentsRef.update(updates);\n    } catch (error) {\n      console.error('Error deleting user data:', error);\n    }\n  };\n\n  const handleUserDeleteData = async (userId) => {\n    try {\n      // Reference the profile path in the Realtime Database\n      const profileRef = app4.database().ref('profile');\n\n      // Query the profile data once\n      const snapshot = await profileRef.once('value');\n\n      // Create an object to store the updates\n      const updates = {};\n\n      // Iterate through each profile entry\n      snapshot.forEach((childSnapshot) => {\n        // Check if the key (ID) matches the user ID\n        if (childSnapshot.key === userId) {\n          updates[childSnapshot.key] = null;\n        }\n      });\n\n      // Update the profile data with null values to delete the entry\n      await profileRef.update(updates);\n    } catch (error) {\n      console.error('Error deleting user data:', error);\n    }\n  };\n\n  return (\n    <>\n      <Button style={{backgroundColor: 'red', outline:\"red\"}} severity=\"danger\"  label=\"I understand, delete my account\" onClick={handleDeleteAccount} disabled={loading} />\n\n    </>\n  );\n}\n\nexport default DeleteAccountButton;\n"],"names":["firebaseConfig2","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","useAuth","firebase","initializeApp","app05","app","apps","user","setUser","useState","loading","setLoading","useEffect","unsubscribe","auth","onAuthStateChanged","firebaseUser","signInWithEmailAndPassword","email","password","signOut","firebaseConfig922","measurementId","_ref","toastRef","app4","app44","toast","setToast","handleUserDeletion","async","commentsRef","database","ref","snapshot","orderByChild","equalTo","userId","once","updates","forEach","childSnapshot","key","update","error","console","handleUserDeleteData","profileRef","React","Button","style","backgroundColor","outline","severity","label","onClick","uid","delete","navigate","current","show","summary","detail","code","message","disabled"],"sourceRoot":""}